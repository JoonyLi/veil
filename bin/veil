#!/bin/bash

if [ -z "$VEIL_HOME" ] ; then
    export VEIL_HOME="."
fi
if [ ! -d $VEIL_HOME/env/bin ] ; then
	echo "VEIL_HOME is invalid"
	exit 1
fi

source $VEIL_HOME/env/bin/activate

if [[ $1 == :* ]] ; then
    COLON_VEIL_SERVER=$1
    shift
    VEIL_SERVER=${COLON_VEIL_SERVER:1} veil $@ || exit $?
    exit 0
fi

case "$1" in
    execute)
        shift
        exec $@
        ;;
    up)
        exec veil supervisor up
        ;;
    self-check)
        exec veil :test development test self-check
        ;;
    *)
        exec python -m veil $@
esac